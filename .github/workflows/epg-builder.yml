name: Build EPG Every 12 Hours

on:
  schedule:
    - cron: "0 */12 * * *"   # Runs every 12 hours
  workflow_dispatch:        # Allows manual running

jobs:
  build_epg:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v4

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y python3 python3-pip gzip
        pip install requests lxml

        - name: Download XML + GZ from Google Drive
      run: |
        mkdir -p epg_downloads

        echo "Downloading latest XML..."
        wget -O epg_downloads/combined_epg_latest.xml \
          "https://drive.google.com/uc?export=download&id=10z8VQfoiVlJBKTORT0POjb5WYbiAf3ps"

        echo "Downloading latest GZ..."
        wget -O epg_downloads/combined_epg_latest.xml.gz \
          "https://drive.google.com/uc?export=download&id=16EHifrYxpROFcnM0fps79WXYYA1yx__o"

    - name: Re-compress for GitHub (good measure)
      run: |
        gzip -c epg_downloads/latest.xml > combined_epg_latest.xml.gz

    - name: Upload latest epg to repo
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "Auto-update EPG"
        file_pattern: combined_epg_latest.xml.gz
